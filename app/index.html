<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitrauschen</title>
  <link rel="stylesheet" href="/static/app/style.css">
  <link rel="icon" href="/static/app/favicon.ico">
  
  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  
  <!-- D3.js v3 (required by script.js) -->
  <script src="https://d3js.org/d3.v3.min.js"></script>
  
  <!-- Lodash (required by script.js for _.set function) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  
  <!-- Slick Carousel -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>
  
  <!-- History.js for browser navigation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/history.js/1.8/bundled/html4+html5/jquery.history.min.js"></script>
</head>
<body class="light-mode">
  <div id="app">
    <!-- App content will be generated by script.js -->
    <div id="map" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;"></div>
    <div id="planet"></div>
    <div id="color-ring" style="width: 600px; height: 600px;"></div>
    <div id="glow-ring" style="width: 600px; height: 600px;"></div>
    <div id="infoModal"></div>
  </div>

  <!-- Hamburger Menu -->
  <div id="menu-button" style="position:fixed; top:10px; left:10px; z-index:1000; cursor:pointer; background:rgba(255,255,255,0.9); padding:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2);">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </div>

  <!-- Menu Panel - loaded dynamically -->
  <div id="menu-panel" style="position:fixed; top:0; left:-300px; width:280px; height:100%; background:rgba(255,255,255,0.95); z-index:999; transition:left 0.3s; padding:60px 20px 20px; box-shadow:2px 0 10px rgba(0,0,0,0.1); overflow-y:auto;">
    <div style="margin-bottom:30px;">
      <h3 style="margin:0 0 15px; font-size:18px; font-weight:bold;">Menu</h3>
      <div id="menu-items">
        <!-- Menu items loaded from /api/menu/ -->
      </div>
    </div>
  </div>

  <!-- Search - at the very top -->
  <div id="search" style="position:fixed; top:10px; right:10px; z-index:9;">
    <input type="text" id="klang" placeholder="Search projects, categories, years..." style="padding:10px; width:250px; border:1px solid #ccc; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
  </div>

  <!-- Language buttons - below zoom controls, stacked vertically -->
  <div id="lang-switcher" style="position:fixed; top:110px; right:10px; z-index:9; display:flex; flex-direction:column; gap:5px;">
    <button class="EN" onclick="setCurrentLanguage('en')" style="padding:8px 12px; border:1px solid #ccc; background:rgba(255,255,255,0.9); cursor:pointer; border-radius:3px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.2); min-width:40px;">EN</button>
    <button class="DE" onclick="setCurrentLanguage('de')" style="padding:8px 12px; border:1px solid #ccc; background:rgba(255,255,255,0.9); cursor:pointer; border-radius:3px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.2); min-width:40px;">DE</button>
    <button class="NL" onclick="setCurrentLanguage('nl')" style="padding:8px 12px; border:1px solid #ccc; background:rgba(255,255,255,0.9); cursor:pointer; border-radius:3px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.2); min-width:40px;">NL</button>
  </div>

  <script>
    // Hamburger menu toggle
    document.getElementById('menu-button').addEventListener('click', function() {
      var panel = document.getElementById('menu-panel');
      if (panel.style.left === '0px') {
        panel.style.left = '-300px';
      } else {
        panel.style.left = '0px';
      }
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
      var panel = document.getElementById('menu-panel');
      var button = document.getElementById('menu-button');
      if (!panel.contains(e.target) && !button.contains(e.target) && panel.style.left === '0px') {
        panel.style.left = '-300px';
      }
    });
  </script>


    // Load menu items and setup content modals
    Promise.all([
      fetch('/api/v1/menu/').then(r => r.json()),
      fetch('/api/v1/menu-content/').then(r => r.json())
    ]).then(([menuData, contentData]) => {
      // Create content sections object for easy lookup
      const contentSections = {};
      contentData.sections.forEach(section => {
        contentSections[section.section_key] = section;
      });
      
      // Render menu items
      const menuHTML = menuData.items.map(item => {
        const sectionKey = item.url.replace('#', '');
        return `<div style="margin-bottom:10px;"><a href="${item.url}" class="menu-link" data-section="${sectionKey}" style="display:block; padding:8px 0; text-decoration:none; color:#333; transition:color 0.2s;" onmouseover="this.style.color='#0066cc'" onmouseout="this.style.color='#333'">${item.title}</a></div>`;
      }).join('');
      document.getElementById('menu-items').innerHTML = menuHTML;
      
      // Add modal for content display
      const modal = document.createElement('div');
      modal.id = 'content-modal';
      modal.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:10000; overflow:auto;';
      modal.innerHTML = '<div style="background:white; margin:50px auto; max-width:800px; padding:40px; border-radius:10px; position:relative;"><button id="close-modal" style="position:absolute; top:15px; right:15px; background:transparent; border:none; font-size:30px; cursor:pointer; color:#666;">&times;</button><div id="modal-content"></div></div>';
      document.body.appendChild(modal);
      
      // Handle menu link clicks
      document.querySelectorAll('.menu-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const sectionKey = this.dataset.section;
          const section = contentSections[sectionKey];
          if (section) {
            document.getElementById('modal-content').innerHTML = '<h2 style="margin-top:0;">' + section.title + '</h2>' + section.content_html;
            modal.style.display = 'block';
            document.getElementById('menu-panel').style.left = '-300px';
          }
        });
      });
      
      // Close modal handlers
      document.getElementById('close-modal').addEventListener('click', () => {
        modal.style.display = 'none';
      });
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.style.display = 'none';
      });
    }).catch(error => {}); // Silently handle errors


  <script src="/static/app/settings.js"></script>
  <script src="/static/app/mapboxutil.js"></script>
  <script src="/static/app/script.js"></script>
</body>
</html>
